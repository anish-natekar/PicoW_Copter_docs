<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to PicoW_Copter_Docs’s documentation! &mdash; PicoW_Copter_Docs 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            PicoW_Copter_Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Welcome to PicoW_Copter_Docs’s documentation!</a></li>
<li><a class="reference internal" href="#hardware">Hardware</a><ul>
<li><a class="reference internal" href="#bill-of-materials">Bill of Materials</a></li>
<li><a class="reference internal" href="#pcb">PCB</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#receiver">Receiver</a></li>
<li><a class="reference internal" href="#gyro">Gyro</a></li>
<li><a class="reference internal" href="#bmp280">BMP280</a></li>
<li><a class="reference internal" href="#motor-control">Motor control</a></li>
<li><a class="reference internal" href="#battery-voltage">Battery voltage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#software">Software</a></li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">PicoW_Copter_Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Welcome to PicoW_Copter_Docs’s documentation!</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="welcome-to-picow-copter-docs-s-documentation">
<h1>Welcome to PicoW_Copter_Docs’s documentation!<a class="headerlink" href="#welcome-to-picow-copter-docs-s-documentation" title="Permalink to this heading"></a></h1>
<p>This is the Official Documentation for the PicoW Copter
The PicoW Copter is an open source micro sub 60g quadcopter that is controlled using WiFi via a smartphone or computer.
The PicoW Copter is designed to be a low cost, easy to build, and fun to fly quadcopter.</p>
</section>
<section id="hardware">
<h1>Hardware<a class="headerlink" href="#hardware" title="Permalink to this heading"></a></h1>
<p>The Hardware required can be found in the Hardware folder of PicoW Copter project.
The Harware folders contains a BOM, PCB gerber files, and STL file for the frame.
The BOM provided contains links for the parts from online indian websites but you can easily find them for other countries as well.</p>
<section id="bill-of-materials">
<h2>Bill of Materials<a class="headerlink" href="#bill-of-materials" title="Permalink to this heading"></a></h2>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">BOM</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Part Name</p></th>
<th class="head"><p>Quantity</p></th>
<th class="head"><p>Link</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Raspberry Pi Pico W</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://robu.in/product/raspberry-pi-pico-w/">https://robu.in/product/raspberry-pi-pico-w/</a> |</p></td>
</tr>
<tr class="row-odd"><td><p>MPU6050</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://robu.in/product/mpu-6050-gyro-sensor-2-accelerometer/">https://robu.in/product/mpu-6050-gyro-sensor-2-accelerometer/</a> |</p></td>
</tr>
<tr class="row-even"><td><p>1S 360mAh Lipo Battery</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://robu.in/product/orange-360-mah-1s-30c-60c-lithium-polymer-battery-pack-lipo/">https://robu.in/product/orange-360-mah-1s-30c-60c-lithium-polymer-battery-pack-lipo/</a> |</p></td>
</tr>
<tr class="row-odd"><td><p>720 Coreless Motor</p></td>
<td><p>4</p></td>
<td><p><a class="reference external" href="https://robu.in/product/8520-magnetic-micro-coreless-motor-for-micro-quadcopters-2xcw-2xccw/">https://robu.in/product/8520-magnetic-micro-coreless-motor-for-micro-quadcopters-2xcw-2xccw/</a> |</p></td>
</tr>
<tr class="row-even"><td><p>55mm Propeller (included with motors)</p></td>
<td><p>4</p></td>
<td><p><a class="reference external" href="https://robu.in/product/8520-magnetic-micro-coreless-motor-for-micro-quadcopters-2xcw-2xccw/">https://robu.in/product/8520-magnetic-micro-coreless-motor-for-micro-quadcopters-2xcw-2xccw/</a> |</p></td>
</tr>
<tr class="row-odd"><td><p>si2302 N channel Mosfet</p></td>
<td><p>4</p></td>
<td><p><a class="reference external" href="https://www.ktron.in/product/si2302-mosfet-sot23/">https://www.ktron.in/product/si2302-mosfet-sot23/</a> |</p></td>
</tr>
<tr class="row-even"><td><p>1N4007 Diode</p></td>
<td><p>4</p></td>
<td><p><a class="reference external" href="https://robu.in/product/1n4148-surface-mount-zener-diode-pack-of-30/">https://robu.in/product/1n4148-surface-mount-zener-diode-pack-of-30/</a> |</p></td>
</tr>
<tr class="row-odd"><td><p>Male Pin headers</p></td>
<td><p>44</p></td>
<td><p><a class="reference external" href="https://www.ktron.in/product/header-pins-40x1-2-54mm-pitch-brass/">https://www.ktron.in/product/header-pins-40x1-2-54mm-pitch-brass/</a> |</p></td>
</tr>
<tr class="row-even"><td><p>Female Pin headers</p></td>
<td><p>40</p></td>
<td><p><a class="reference external" href="https://www.ktron.in/product/berg-strip-female-2-54mm-brass/">https://www.ktron.in/product/berg-strip-female-2-54mm-brass/</a> |</p></td>
</tr>
<tr class="row-odd"><td><p>XH male connector</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://www.ktron.in/product/2pin-jst-xh-male-connector/">https://www.ktron.in/product/2pin-jst-xh-male-connector/</a> |</p></td>
</tr>
<tr class="row-even"><td><p>Push Button</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://www.ktron.in/product/3x6x2-5mm-tactile-switch-smd/">https://www.ktron.in/product/3x6x2-5mm-tactile-switch-smd/</a> |</p></td>
</tr>
<tr class="row-odd"><td><p>BMP 280</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://robu.in/product/bmp280-barometric-pressure-and-altitude-sensor-i2c-spi-module/">https://robu.in/product/bmp280-barometric-pressure-and-altitude-sensor-i2c-spi-module/</a> |</p></td>
</tr>
<tr class="row-even"><td><p>1S Lipo charger</p></td>
<td><p>1</p></td>
<td><p><a class="reference external" href="https://robu.in/product/4-port-dc5v-1s-rc-lithium-lipo-battery-compact-balance-charger-rc-quadcopter/">https://robu.in/product/4-port-dc5v-1s-rc-lithium-lipo-battery-compact-balance-charger-rc-quadcopter/</a> |</p></td>
</tr>
</tbody>
</table>
<p>Taking Rs 160 for 1 PCB and Rs 160 for 3D printed frame from an online service.
The total cost of the hardware is just above 2000 INR or 30 USD.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most of the hardware won’t be available in small quantities so it is adviced to anyone lloking to build this project to try to build multiple of them either for yourself or a group of friends.</p>
</div>
</section>
<section id="pcb">
<h2>PCB<a class="headerlink" href="#pcb" title="Permalink to this heading"></a></h2>
<a class="reference internal image-reference" href="_images/PCB.png"><img alt="PCB" class="align-center" src="_images/PCB.png" style="width: 80%;" /></a>
<p>The PCB Gerber files are given in the <em>PCB_Gerber_PicoW_Copter</em> folder.
The PCB is a double layered, 4cm X 6cm, 1oz copper, 1.6mm PCB.</p>
<a class="reference internal image-reference" href="_images/Schematic_PicoW_Copter.png"><img alt="Schematic" class="align-center" src="_images/Schematic_PicoW_Copter.png" style="width: 100%;" /></a>
</section>
</section>
<section id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this heading"></a></h1>
<p>Testing script are not only useful to test individual hardware components of the PicoW Copter
but also a great way to learn how individual components work.
This project is complex but extremely affordable allowing room for errors and mistakes even for complete beginners.
Anyone looking to modify the code and hardware is more than welcome to do so.</p>
<section id="receiver">
<h2>Receiver<a class="headerlink" href="#receiver" title="Permalink to this heading"></a></h2>
<p>The PicoW Copter uses the onboard infenion WiFi chip of the raspberry Pi PicoW to communicate with a device (smartphone or computer) through UDP packets.
The static IP address when using the Pi Pico over access point mode (hotspot mode) is 192.168.1.42 by default.
The main motivation for using UDP is real time control of the PicoW Copter. The time taken to read packets is around 200 microseconds.</p>
<div class="highlight-arduino notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;WiFi.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;WiFiUdp.h&gt;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="cp">#ifndef APSSID</span>
<span class="linenos"> 5</span><span class="cp">#define APSSID &quot;PicoW&quot;    </span><span class="c1">// name of your PicoW Hotspot</span>
<span class="linenos"> 6</span><span class="cp">#define APPSW &quot;password&quot; </span><span class="c1">// password of your PicoW Hotspot</span>
<span class="linenos"> 7</span><span class="cp">#endif</span>
<span class="linenos"> 8</span><span class="cp">#define UDP_PKT_MAX_SIZE 16 </span><span class="c1">//  number of characters in a UDP packet</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="n">localPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8888</span><span class="p">;</span><span class="w">  </span><span class="c1">// local port for UDP communication</span>
<span class="linenos">11</span><span class="kr">char</span><span class="w"> </span><span class="n">packetBuffer</span><span class="p">[</span><span class="n">UDP_PKT_MAX_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">  </span><span class="c1">// max number of characters received in one message</span>
<span class="linenos">12</span><span class="kr">int</span><span class="w"> </span><span class="n">Throttle</span><span class="p">,</span><span class="w"> </span><span class="n">Roll</span><span class="p">,</span><span class="w"> </span><span class="n">Pitch</span><span class="p">,</span><span class="w"> </span><span class="n">Yaw</span><span class="p">;</span><span class="w"> </span><span class="c1">// values received from each channel</span>
<span class="linenos">13</span><span class="kr">int</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="nf">WiFiUDP</span><span class="w"> </span><span class="n">Udp</span><span class="p">;</span><span class="w"> </span><span class="c1">// Object for WIFI UDP class</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="kr">void</span><span class="w"> </span><span class="nb">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">18</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">  </span><span class="nf">WiFi</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="n">WIFI_AP</span><span class="p">);</span><span class="w"> </span><span class="c1">// Access Point mode</span>
<span class="linenos">20</span><span class="w">  </span><span class="nf">WiFi</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="n">APSSID</span><span class="p">,</span><span class="w"> </span><span class="n">APPSW</span><span class="p">);</span><span class="w">  </span><span class="c1">// By default static IP for PicoW will be 192.168.42.1</span>
<span class="linenos">21</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="nf">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WL_CONNECTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">    </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">// waiting for connection</span>
<span class="linenos">23</span><span class="w">    </span><span class="nf">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0.5 sec delay</span>
<span class="linenos">24</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">25</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Connected! IP address: &quot;</span><span class="p">);</span>
<span class="linenos">26</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="nf">WiFi</span><span class="p">.</span><span class="nf">localIP</span><span class="p">());</span><span class="w">   </span><span class="c1">// The IP Address is 192.168.42.1</span>
<span class="linenos">27</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;UDP server on port %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">localPort</span><span class="p">);</span><span class="w">  </span><span class="c1">// Port is 8888</span>
<span class="linenos">28</span><span class="w">  </span><span class="n">Udp</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="n">localPort</span><span class="p">);</span><span class="w"> </span><span class="c1">// start listening on port 8888</span>
<span class="linenos">29</span><span class="p">}</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="kr">void</span><span class="w"> </span><span class="nb">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">32</span><span class="w">  </span><span class="c1">// if there is data available to read then read a packet</span>
<span class="linenos">33</span><span class="w">  </span><span class="kr">int</span><span class="w"> </span><span class="n">packetSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Udp</span><span class="p">.</span><span class="nf">parsePacket</span><span class="p">();</span>
<span class="linenos">34</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">packetSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// if packet size is &gt; 0</span>
<span class="linenos">35</span><span class="w">    </span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">micros</span><span class="p">();</span>
<span class="linenos">36</span><span class="w">    </span><span class="kr">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Udp</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">packetBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">UDP_PKT_MAX_SIZE</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the data from UDP packet into packetBuffer</span>
<span class="linenos">37</span><span class="w">    </span><span class="n">packetBuffer</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// character for end of string</span>
<span class="linenos">38</span><span class="w">    </span><span class="kr">char</span><span class="w"> </span><span class="n">ch1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">ch2</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">ch3</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="n">ch4</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">  </span><span class="c1">//</span>
<span class="linenos">39</span><span class="w">    </span><span class="n">ch1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">ch2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">ch3</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">ch4</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="linenos">40</span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kr">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">      </span><span class="c1">// Spliting the packets into four values of 4 characters each</span>
<span class="linenos">42</span><span class="w">      </span><span class="n">ch1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packetBuffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="linenos">43</span><span class="w">      </span><span class="n">ch2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packetBuffer</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">];</span>
<span class="linenos">44</span><span class="w">      </span><span class="n">ch3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packetBuffer</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">];</span>
<span class="linenos">45</span><span class="w">      </span><span class="n">ch4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packetBuffer</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">12</span><span class="p">];</span>
<span class="linenos">46</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">47</span><span class="w">    </span><span class="c1">// converting string/character arrays to integer</span>
<span class="linenos">48</span><span class="w">    </span><span class="n">Yaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">ch1</span><span class="p">);</span>
<span class="linenos">49</span><span class="w">    </span><span class="n">Throttle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">ch2</span><span class="p">);</span>
<span class="linenos">50</span><span class="w">    </span><span class="n">Roll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">ch3</span><span class="p">);</span>
<span class="linenos">51</span><span class="w">    </span><span class="n">Pitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">ch4</span><span class="p">);</span>
<span class="linenos">52</span><span class="w">    </span><span class="nf">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Yaw = %d, Throttle = %d, Roll = %d, Pitch = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Yaw</span><span class="p">,</span><span class="w"> </span><span class="n">Throttle</span><span class="p">,</span><span class="w"> </span><span class="n">Roll</span><span class="p">,</span><span class="w"> </span><span class="n">Pitch</span><span class="p">);</span>
<span class="linenos">53</span><span class="w">    </span><span class="nf">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Time taken = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">micros</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prev</span><span class="p">);</span>
<span class="linenos">54</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">55</span><span class="p">}</span>
</pre></div>
</div>
<p>The UDP packets are sent by an APP or software (in our case this python code) on the device to the PicoW’s IP address and port number provided in the Receiver.ino file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">socket</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">UDP_IP</span> <span class="o">=</span> <span class="s2">&quot;192.168.1.42&quot;</span>
<span class="linenos"> 5</span><span class="n">UDP_PORT</span> <span class="o">=</span> <span class="mi">8888</span>
<span class="linenos"> 6</span><span class="n">MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;1000100110021003&quot;</span> <span class="c1"># sending four 4 digit long numbers</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># creating a UDP socket (UDP is connection less)</span>
<span class="linenos"> 9</span><span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">server</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">MESSAGE</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">UDP_IP</span><span class="p">,</span> <span class="n">UDP_PORT</span><span class="p">))</span>
<span class="linenos">12</span>    <span class="c1"># sleep for 1 second</span>
<span class="linenos">13</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gyro">
<h2>Gyro<a class="headerlink" href="#gyro" title="Permalink to this heading"></a></h2>
<p>The MPU6050 is a 6 axis gyroscope and accelerometer sensor. It is used to measure the orientation of the PicoW Copter.
The MPU6050 is connected to the Pi PicoW using I2C protocol communicatin at a frequency of 400kHz. The I2C address of the MPU6050 is 0x68.
All i2c register addresses can be found in the MPU6050 manual by invensense. Joop Brokking has a great tutorial on how to use the MPU6050 with Arduino.</p>
<div class="highlight-arduino notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="cpf">&lt;Wire.h&gt;</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="cp">#define I2C_CLK_FREQ 400000 </span><span class="c1">// 400kHz</span>
<span class="linenos">  4</span><span class="kr">const</span><span class="w"> </span><span class="n">u_int8_t</span><span class="w"> </span><span class="n">IMUAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x68</span><span class="p">;</span><span class="w">  </span><span class="c1">// Address for MPU6050 IMU sensor</span>
<span class="linenos">  5</span><span class="c1">// IMU offset</span>
<span class="linenos">  6</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">gyroXoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">  7</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">gyroYoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">  8</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">gyroZoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">  9</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">accXoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 10</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">accYoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 11</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">accZoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 12</span><span class="c1">// MPU6050 IMU</span>
<span class="linenos"> 13</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">accX</span><span class="p">,</span><span class="w"> </span><span class="n">accY</span><span class="p">,</span><span class="w"> </span><span class="n">accZ</span><span class="p">;</span><span class="w"> </span><span class="c1">// accelerometer</span>
<span class="linenos"> 14</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">tempRaw</span><span class="p">;</span>
<span class="linenos"> 15</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">gyroX</span><span class="p">,</span><span class="w"> </span><span class="n">gyroY</span><span class="p">,</span><span class="w"> </span><span class="n">gyroZ</span><span class="p">;</span><span class="w"> </span><span class="c1">// gyroscope</span>
<span class="linenos"> 16</span><span class="kr">float</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"> </span><span class="c1">// temperature</span>
<span class="linenos"> 17</span><span class="kr">int</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span><span class="w">   </span><span class="c1">// keeps track of time before reading IMU data</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span><span class="kr">void</span><span class="w"> </span><span class="nb">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 20</span><span class="w">  </span><span class="nf">pinMode</span><span class="p">(</span><span class="kr">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="kr">OUTPUT</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the built in LED pin as Output</span>
<span class="linenos"> 21</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="linenos"> 22</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="n">setClock</span><span class="p">(</span><span class="n">I2C_CLK_FREQ</span><span class="p">);</span><span class="w">  </span><span class="c1">// setting I2C communication frequency to 400kHz</span>
<span class="linenos"> 23</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">begin</span><span class="p">();</span><span class="w"> </span><span class="c1">// starting I2C communication over SDA0 and SCL0 pins</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">);</span>
<span class="linenos"> 26</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x6B</span><span class="p">);</span><span class="w"> </span><span class="c1">// PWR_MGMT_1</span>
<span class="linenos"> 27</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
<span class="linenos"> 28</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">);</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x1B</span><span class="p">);</span><span class="w"> </span><span class="c1">// GYRO_CONFIG</span>
<span class="linenos"> 32</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x08</span><span class="p">);</span><span class="w"> </span><span class="c1">// +- 1000 degrees/s</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">);</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x1C</span><span class="p">);</span><span class="w"> </span><span class="c1">// ACCEL_CONFIG</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x10</span><span class="p">);</span><span class="w"> </span><span class="c1">// +- 16g</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">);</span>
<span class="linenos"> 41</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x1A</span><span class="p">);</span><span class="w"> </span><span class="c1">// CONFIG</span>
<span class="linenos"> 42</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x03</span><span class="p">);</span>
<span class="linenos"> 43</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="c1">// IMU offset calculation</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="kr">int</span><span class="w"> </span><span class="n">offcnt</span><span class="p">;</span>
<span class="linenos"> 47</span><span class="w">  </span><span class="kr">long</span><span class="w"> </span><span class="n">gx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">gy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">gz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">ay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">az</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// variables to store sum of 1000 readings</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">offcnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">offcnt</span><span class="o">&lt;=</span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">offcnt</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 49</span><span class="w">    </span><span class="c1">// Reading IMU data 1000 times to calculate offset values of IMU</span>
<span class="linenos"> 50</span><span class="w">    </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">);</span>
<span class="linenos"> 51</span><span class="w">    </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x3B</span><span class="p">);</span><span class="w"> </span><span class="c1">// GyroXhigh byte</span>
<span class="linenos"> 52</span><span class="w">    </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">requestFrom</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">);</span><span class="w"> </span><span class="c1">// request 14 bytes of data from IMU</span>
<span class="linenos"> 54</span><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">available</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="p">);</span><span class="w"> </span><span class="c1">// If we have received 14 bytes exit out of loop</span>
<span class="linenos"> 55</span><span class="w">    </span><span class="c1">// read IMU data values</span>
<span class="linenos"> 56</span><span class="w">    </span><span class="n">accX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 57</span><span class="w">    </span><span class="n">accY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 58</span><span class="w">    </span><span class="n">accZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="n">tempRaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 60</span><span class="w">    </span><span class="n">gyroX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 61</span><span class="w">    </span><span class="n">gyroY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 62</span><span class="w">    </span><span class="n">gyroZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="c1">// Sum the values read from IMU</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="n">gx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">gyroX</span><span class="p">;</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="n">gy</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">gyroY</span><span class="p">;</span>
<span class="linenos"> 66</span><span class="w">    </span><span class="n">gz</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">gyroZ</span><span class="p">;</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="n">ax</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">accX</span><span class="p">;</span>
<span class="linenos"> 68</span><span class="w">    </span><span class="n">ay</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">accY</span><span class="p">;</span>
<span class="linenos"> 69</span><span class="w">    </span><span class="n">az</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">accZ</span><span class="p">;</span>
<span class="linenos"> 70</span><span class="w">    </span><span class="nf">delay</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// simulating delay for rest of the quadcopter processes</span>
<span class="linenos"> 71</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">offcnt</span><span class="o">%</span><span class="mi">40</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 72</span><span class="w">      </span><span class="nf">digitalWrite</span><span class="p">(</span><span class="kr">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="kr">HIGH</span><span class="p">);</span><span class="w">  </span><span class="c1">// LED blinks to indicate offset calculation is going on</span>
<span class="linenos"> 73</span><span class="w">    </span><span class="k">else</span>
<span class="linenos"> 74</span><span class="w">      </span><span class="nf">digitalWrite</span><span class="p">(</span><span class="kr">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="kr">LOW</span><span class="p">);</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="c1">// get the average of 1000 readings</span>
<span class="linenos"> 77</span><span class="w">  </span><span class="n">gyroXoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">int16_t</span><span class="p">)(</span><span class="n">gx</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
<span class="linenos"> 78</span><span class="w">  </span><span class="n">gyroYoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">int16_t</span><span class="p">)(</span><span class="n">gy</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="n">gyroZoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">int16_t</span><span class="p">)(</span><span class="n">gz</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="n">accXoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">int16_t</span><span class="p">)(</span><span class="n">ax</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
<span class="linenos"> 81</span><span class="w">  </span><span class="n">accYoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">int16_t</span><span class="p">)(</span><span class="n">ay</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
<span class="linenos"> 82</span><span class="w">  </span><span class="n">accZoffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">int16_t</span><span class="p">)(</span><span class="n">az</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
<span class="linenos"> 83</span><span class="p">}</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span><span class="kr">void</span><span class="w"> </span><span class="nb">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 86</span><span class="w">  </span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">micros</span><span class="p">();</span><span class="w">  </span><span class="c1">// record time when we started reading IMU data</span>
<span class="linenos"> 87</span><span class="w">  </span><span class="c1">// read IMU values</span>
<span class="linenos"> 88</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">);</span>
<span class="linenos"> 89</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x3B</span><span class="p">);</span>
<span class="linenos"> 90</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 91</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">requestFrom</span><span class="p">(</span><span class="n">IMUAddress</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">);</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">available</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">14</span><span class="p">);</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="n">accX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 96</span><span class="w">  </span><span class="n">accY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 97</span><span class="w">  </span><span class="n">accZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">tempRaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 99</span><span class="w">  </span><span class="n">gyroX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos">100</span><span class="w">  </span><span class="n">gyroY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos">101</span><span class="w">  </span><span class="n">gyroZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="o">|</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos">102</span><span class="w">  </span><span class="c1">// subtract offset from readings</span>
<span class="linenos">103</span><span class="w">  </span><span class="n">gyroX</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">gyroXoffset</span><span class="p">;</span>
<span class="linenos">104</span><span class="w">  </span><span class="n">gyroY</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">gyroYoffset</span><span class="p">;</span>
<span class="linenos">105</span><span class="w">  </span><span class="n">gyroZ</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">gyroZoffset</span><span class="p">;</span>
<span class="linenos">106</span><span class="w">  </span><span class="n">accX</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">accXoffset</span><span class="p">;</span>
<span class="linenos">107</span><span class="w">  </span><span class="n">accY</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">accYoffset</span><span class="p">;</span>
<span class="linenos">108</span><span class="w">  </span><span class="n">accZ</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">accZoffset</span><span class="p">;</span>
<span class="linenos">109</span><span class="w">  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">float</span><span class="p">)</span><span class="n">tempRaw</span><span class="p">;</span>
<span class="linenos">110</span><span class="w">  </span><span class="c1">// print data</span>
<span class="linenos">111</span><span class="w">  </span><span class="c1">//Serial.printf(&quot;AccX = %d, AccY = %d, AccZ = %d, Temp = &quot;, accX, accY, accZ);</span>
<span class="linenos">112</span><span class="w">  </span><span class="c1">//Serial.print(temp);</span>
<span class="linenos">113</span><span class="w">  </span><span class="c1">//Serial.printf(&quot;, GyroX = %d, GyroY = %d, GyroZ = %d\n&quot;, gyroX, gyroY, gyroZ);</span>
<span class="linenos">114</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Time = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">micros</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prev</span><span class="p">);</span>
<span class="linenos">115</span><span class="w">  </span><span class="nf">delay</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
<span class="linenos">116</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="bmp280">
<h2>BMP280<a class="headerlink" href="#bmp280" title="Permalink to this heading"></a></h2>
<p>The BMP280 is a barometric pressure and temperature sensor. It is used for the altitude hold feature of the PicoW Copter.
The details for the i2c registers of the BMP280 sensor can be found in the data sheet along with the conversions.
I will suggest those who are interested to refer to the video by Carbon Aeronautics.
(This feature is not tested but a script is provided for getting sensor data for PicoW)</p>
<div class="highlight-arduino notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Wire.h&gt;</span>
<span class="linenos">  2</span><span class="cp">#define BMPAddress 0x76</span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="c1">// Barometer calibration values</span>
<span class="linenos">  5</span><span class="kr">uint16_t</span><span class="w"> </span><span class="n">dig_T1</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P1</span><span class="p">;</span>
<span class="linenos">  6</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">dig_T2</span><span class="p">,</span><span class="w"> </span><span class="n">dig_T3</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P2</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P3</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P4</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P5</span><span class="p">;</span>
<span class="linenos">  7</span><span class="kr">int16_t</span><span class="w"> </span><span class="n">dig_P6</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P7</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P8</span><span class="p">,</span><span class="w"> </span><span class="n">dig_P9</span><span class="p">;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="c1">// Altitude variables</span>
<span class="linenos"> 10</span><span class="kr">float</span><span class="w"> </span><span class="n">AltitudeBarometer</span><span class="p">,</span><span class="w"> </span><span class="n">AltitudeBarometerStartUp</span><span class="p">;</span>
<span class="linenos"> 11</span><span class="kr">int</span><span class="w"> </span><span class="n">RateCalibrationNumber</span><span class="p">;</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="c1">// read barometer signal</span>
<span class="linenos"> 14</span><span class="kr">void</span><span class="w"> </span><span class="nf">barometer_signal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 15</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">BMPAddress</span><span class="p">);</span>
<span class="linenos"> 16</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0xF7</span><span class="p">);</span>
<span class="linenos"> 17</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 18</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">requestFrom</span><span class="p">(</span><span class="n">BMPAddress</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="linenos"> 19</span><span class="w">  </span><span class="kr">uint32_t</span><span class="w"> </span><span class="n">press_msb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span><span class="w"> </span><span class="c1">// 0xF7</span>
<span class="linenos"> 20</span><span class="w">  </span><span class="kr">uint32_t</span><span class="w"> </span><span class="n">press_lsb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span><span class="w"> </span><span class="c1">// 0xF8</span>
<span class="linenos"> 21</span><span class="w">  </span><span class="kr">uint32_t</span><span class="w"> </span><span class="n">press_xlsb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 22</span><span class="w">  </span><span class="kr">uint32_t</span><span class="w"> </span><span class="n">temp_msb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 23</span><span class="w">  </span><span class="kr">uint32_t</span><span class="w"> </span><span class="n">temp_lsb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 24</span><span class="w">  </span><span class="kr">uint32_t</span><span class="w"> </span><span class="n">temp_xlsb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span><span class="w"> </span><span class="c1">// 0xFC</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="w">  </span><span class="c1">// Construct raw temperature and pressure measurements</span>
<span class="linenos"> 27</span><span class="w">  </span><span class="c1">// msb contans bits [19-12], lsb contains bits [11-4], and xlsb contains bits [3-0]</span>
<span class="linenos"> 28</span><span class="w">  </span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="n">adc_P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">press_msb</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">press_lsb</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">press_xlsb</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span>
<span class="linenos"> 29</span><span class="w">  </span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="n">adc_T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">temp_msb</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">temp_lsb</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">temp_xlsb</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="c1">// Construct fine resolution temperature value</span>
<span class="linenos"> 32</span><span class="w">  </span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="n">var1</span><span class="p">,</span><span class="w"> </span><span class="n">var2</span><span class="p">;</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((((</span><span class="n">adc_T</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_T1</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)))</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_T2</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">11</span><span class="p">;</span>
<span class="linenos"> 34</span><span class="w">  </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((((</span><span class="n">adc_T</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_T1</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">adc_T</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_T1</span><span class="p">)))</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_T3</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">14</span><span class="p">;</span>
<span class="linenos"> 35</span><span class="w">  </span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="n">t_fine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">var2</span><span class="p">;</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="c1">// Construct the compensated and calibrated pressure p according to manufacturer</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="linenos"> 39</span><span class="w">  </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">t_fine</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="mi">64000</span><span class="p">;</span>
<span class="linenos"> 40</span><span class="w">  </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="n">var1</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">var1</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">11</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P6</span><span class="p">);</span>
<span class="linenos"> 41</span><span class="w">  </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">var1</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P5</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 42</span><span class="w">  </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">var2</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P4</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">);</span>
<span class="linenos"> 43</span><span class="w">  </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="n">dig_P3</span><span class="o">*</span><span class="p">(((</span><span class="n">var1</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">var1</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">13</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="p">((((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P2</span><span class="p">)</span><span class="o">*</span><span class="n">var1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">18</span><span class="p">;</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((((</span><span class="mi">32768</span><span class="o">+</span><span class="n">var1</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P1</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">15</span><span class="p">);</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">var1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)(((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="mi">1048576</span><span class="p">)</span><span class="o">-</span><span class="n">adc_P</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">var2</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">)))</span><span class="o">*</span><span class="mi">3125</span><span class="p">;</span>
<span class="linenos"> 47</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="mh">0x80000000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">var1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">var1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos"> 49</span><span class="w">  </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P9</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)(((</span><span class="n">p</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">13</span><span class="p">)))</span><span class="o">&gt;&gt;</span><span class="mi">12</span><span class="p">;</span>
<span class="linenos"> 50</span><span class="w">  </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)(</span><span class="n">p</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">dig_P8</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">13</span><span class="p">;</span>
<span class="linenos"> 51</span><span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">unsigned</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)((</span><span class="kr">signed</span><span class="w"> </span><span class="kr">long</span><span class="w"> </span><span class="kr">int</span><span class="p">)</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">var1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">var2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dig_P7</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">));</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="w">  </span><span class="kr">double</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kr">double</span><span class="p">)</span><span class="n">p</span><span class="o">/</span><span class="mi">100</span><span class="p">;</span><span class="w">  </span><span class="c1">// pressure in hPa</span>
<span class="linenos"> 54</span><span class="w">  </span><span class="n">AltitudeBarometer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">44330</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nf">pow</span><span class="p">(</span><span class="n">pressure</span><span class="o">/</span><span class="mf">1013.25</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mf">5.255</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// Altitude in cm</span>
<span class="linenos"> 55</span><span class="p">}</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="kr">void</span><span class="w"> </span><span class="nb">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 58</span><span class="w">  </span><span class="c1">// BMP280 setup</span>
<span class="linenos"> 59</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">57600</span><span class="p">);</span>
<span class="linenos"> 60</span><span class="w">  </span><span class="nf">pinMode</span><span class="p">(</span><span class="kr">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="kr">OUTPUT</span><span class="p">);</span>
<span class="linenos"> 61</span><span class="w">  </span><span class="nf">digitalWrite</span><span class="p">(</span><span class="kr">LED_BUILTIN</span><span class="p">,</span><span class="w"> </span><span class="kr">HIGH</span><span class="p">);</span>
<span class="linenos"> 62</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="n">setClock</span><span class="p">(</span><span class="mi">400000</span><span class="p">);</span>
<span class="linenos"> 63</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">begin</span><span class="p">();</span>
<span class="linenos"> 64</span><span class="w">  </span><span class="nf">delay</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span><span class="w">  </span><span class="c1">// Setup BMP280 barometer optimized for indoor navigation</span>
<span class="linenos"> 67</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">BMPAddress</span><span class="p">);</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">);</span><span class="w"> </span><span class="c1">// measurement register setup for indoor mode</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x57</span><span class="p">);</span><span class="w"> </span><span class="c1">// normal mode, pressure oversampling x16 temperature oversampling x2</span>
<span class="linenos"> 70</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 71</span><span class="w">  </span><span class="c1">// Setup configuration register</span>
<span class="linenos"> 72</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">BMPAddress</span><span class="p">);</span>
<span class="linenos"> 73</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0xF5</span><span class="p">);</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x14</span><span class="p">);</span><span class="w"> </span><span class="c1">// IIR filter coefficient 16 rest are 0</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="c1">// Importing 12 trimming parameters from sensor</span>
<span class="linenos"> 77</span><span class="w">  </span><span class="kr">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">24</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 78</span><span class="w">  </span><span class="c1">// First trimming parameter</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">beginTransmission</span><span class="p">(</span><span class="n">BMPAddress</span><span class="p">);</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mh">0x88</span><span class="p">);</span>
<span class="linenos"> 81</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">endTransmission</span><span class="p">();</span>
<span class="linenos"> 82</span><span class="w">  </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">requestFrom</span><span class="p">(</span><span class="n">BMPAddress</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span><span class="w"> </span><span class="c1">// 24 bytes of data from register 0x88 to 0x9F</span>
<span class="linenos"> 83</span><span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="nf">Wire</span><span class="p">.</span><span class="nf">available</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Wire</span><span class="p">.</span><span class="nf">read</span><span class="p">();</span>
<span class="linenos"> 85</span><span class="w">    </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
<span class="linenos"> 86</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 87</span><span class="w">  </span><span class="n">dig_T1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="linenos"> 88</span><span class="w">  </span><span class="n">dig_T2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos"> 89</span><span class="w">  </span><span class="n">dig_T3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="linenos"> 90</span><span class="w">  </span><span class="n">dig_P1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="linenos"> 91</span><span class="w">  </span><span class="n">dig_P2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="linenos"> 92</span><span class="w">  </span><span class="n">dig_P3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="linenos"> 93</span><span class="w">  </span><span class="n">dig_P4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="n">dig_P5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="n">dig_P6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="linenos"> 96</span><span class="w">  </span><span class="n">dig_P7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">18</span><span class="p">];</span>
<span class="linenos"> 97</span><span class="w">  </span><span class="n">dig_P8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">dig_P9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">22</span><span class="p">];</span>
<span class="linenos"> 99</span><span class="w">  </span><span class="nf">delay</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
<span class="linenos">100</span><span class="w">  </span><span class="c1">// barometer calibration calculating altitude reference level</span>
<span class="linenos">101</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">RateCalibrationNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">RateCalibrationNumber</span><span class="o">&lt;</span><span class="mi">2000</span><span class="p">;</span><span class="w"> </span><span class="n">RateCalibrationNumber</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">102</span><span class="w">    </span><span class="n">barometer_signal</span><span class="p">();</span>
<span class="linenos">103</span><span class="w">    </span><span class="n">AltitudeBarometerStartUp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">AltitudeBarometer</span><span class="p">;</span>
<span class="linenos">104</span><span class="w">    </span><span class="nf">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="linenos">105</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">106</span><span class="w">  </span><span class="n">AltitudeBarometerStartUp</span><span class="o">/=</span><span class="mi">2000</span><span class="p">;</span>
<span class="linenos">107</span><span class="p">}</span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="kr">void</span><span class="w"> </span><span class="nb">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">110</span><span class="w">  </span><span class="c1">// Read the barometer and print altitudes</span>
<span class="linenos">111</span><span class="w">  </span><span class="n">barometer_signal</span><span class="p">();</span>
<span class="linenos">112</span><span class="w">  </span><span class="n">AltitudeBarometer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AltitudeBarometerStartUp</span><span class="p">;</span>
<span class="linenos">113</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Altitude [cm]:&quot;</span><span class="p">);</span>
<span class="linenos">114</span><span class="w">  </span><span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">AltitudeBarometer</span><span class="p">);</span>
<span class="linenos">115</span><span class="w">  </span><span class="nf">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="linenos">116</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="motor-control">
<h2>Motor control<a class="headerlink" href="#motor-control" title="Permalink to this heading"></a></h2>
<p>The motors are controlled by a PWM signal generated by using analog write command on digital pins.
The Mosfets act as a switch to rapidly switch the voltage and current from the battery to the motors
according to the PWM signal received. The direction of rotation of the coreless dc motors can be changed
switching the connection of the motor to the flight controller i.e. by switching the polarity.
The direction of rotation for the motors are same as YMFC or Pixhawk/Arducopter quadcopters i.e.
front right CCW, front left CW, bottom right CW and bottom left CCW. This script is not only useful to test the
motors but also test the direction of rotation of the motors.
(waiting for PCB to test script)</p>
</section>
<section id="battery-voltage">
<h2>Battery voltage<a class="headerlink" href="#battery-voltage" title="Permalink to this heading"></a></h2>
<p>While flying any quadcopter it is important to keep track of the battery voltage. The battery is a 1S Lipo 360mAh Battery
and it is important to be careful when using Lipo batteries in any project as special care needs to be taken to prevent
over discharge (while flying) and over charge (while charging). If you Lipo looks swollen it is recommended to dispose it in
a controlled manner i.e. first using a large resistance to slowly discharge the Lipo completely and slowly and then burrying it.
This script reads the battery voltage from the A0 pin and sends the reading over WiFi using UDP to another device.</p>
</section>
</section>
<section id="software">
<h1>Software<a class="headerlink" href="#software" title="Permalink to this heading"></a></h1>
<p>The main software contains the flight controller.
(Yet to be tested!)</p>
<div class="toctree-wrapper compound">
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Anish Y Natekar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>